<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://ziqi-yang.github.io/blog_meow/scss/main.min.css></head><link rel=stylesheet href=https://ziqi-yang.github.io/blog_meow/scss/single.min.css><body><div id=nav-border><nav id=nav><a class=nav-link href=/blog_meow/>Home</a>
<a class=nav-link href=/blog_meow/tags/>Tags</a>
<a class=nav-link href=/blog_meow/archives/>Archives</a>
<a class=nav-link href=/blog_meow/about/>About me</a>
<a class=nav-link href=/blog_meow/index.xml>Rss</a></nav></div><div id=content><main><article><header><h1>Clash_on_linux_server</h1></header><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Tips</h2><div id=outline-text-headline-1 class=outline-text-2><p>Github Acceleration: <a href=https://ghproxy.com/>https://ghproxy.com/</a></p></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Steps</h2><div id=outline-text-headline-2 class=outline-text-2><div id=outline-container-headline-3 class=outline-3><h3 id=headline-3>Download clash core</h3><div id=outline-text-headline-3 class=outline-text-3><ol><li><p>goto <code class=verbatim>https://github.com/Dreamacro/clash/releases</code>
download corresponding releases into your server</p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#080;font-style:italic># use github acceleration service</span>
</span></span><span style=display:flex><span>wget https://ghproxy.com/https://github.com/Dreamacro/clash/releases/download/v1.13.0/clash-linux-amd64-v1.13.0.gz
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic># or manual download it and use scp/rsync to transfer it to your server</span></span></span></code></pre></td></tr></table></div></div></div></li><li><p>unarchive and install core
change <code class=verbatim>&lt;clash></code> to the actual name of the downloaded file</p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>gzip -d &lt;clash&gt;.gz
</span></span><span style=display:flex><span>mv &lt;clash&gt;.gz clash.gz
</span></span><span style=display:flex><span>chmod +x ./clash
</span></span><span style=display:flex><span>mv ./clash /usr/bin/clash</span></span></code></pre></td></tr></table></div></div></div></li></ol></div></div><div id=outline-container-headline-4 class=outline-3><h3 id=headline-4>Make clash configuration directory</h3><div id=outline-text-headline-4 class=outline-text-3><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo mkdir /etc/clash</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=outline-container-headline-5 class=outline-3><h3 id=headline-5>Config.yaml</h3><div id=outline-text-headline-5 class=outline-text-3><p>copy your <code class=verbatim>config.yaml</code> and paste it on your server</p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo nvim /etc/clash/config.yaml</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=outline-container-headline-6 class=outline-3><h3 id=headline-6>Country.mmdb</h3><div id=outline-text-headline-6 class=outline-text-3><p>Go to <a href=https://github.com/Dreamacro/maxmind-geoip/releases/>https://github.com/Dreamacro/maxmind-geoip/releases/</a></p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo wget -O /etc/clash/Country.mmdb https://ghproxy.com/https://github.com/Dreamacro/maxmind-geoip/releases/latest/download/Country.mmdb</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=outline-container-headline-7 class=outline-3><h3 id=headline-7>Run clash daemon</h3><div id=outline-text-headline-7 class=outline-text-3><div id=outline-container-headline-8 class=outline-4><h4 id=headline-8>One Method: manualy run</h4><div id=outline-text-headline-8 class=outline-text-4><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo clash -d /etc/clash</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=outline-container-headline-9 class=outline-4><h4 id=headline-9>Another Method: use service</h4><div id=outline-text-headline-9 class=outline-text-4><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo nvim /etc/systemd/system/clash.service</span></span></code></pre></td></tr></table></div></div></div><p>fill it with this content:</p><div class="src src-text"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text><span style=display:flex><span>[Unit]
</span></span><span style=display:flex><span>Description=clash daemon
</span></span><span style=display:flex><span>[Service]
</span></span><span style=display:flex><span>Type=simple
</span></span><span style=display:flex><span>User=root
</span></span><span style=display:flex><span>ExecStart=/usr/bin/clash -d /etc/clash/
</span></span><span style=display:flex><span>Restart=on-failure
</span></span><span style=display:flex><span>[Install]
</span></span><span style=display:flex><span>WantedBy=multi-user.target</span></span></code></pre></td></tr></table></div></div></div><p>Enable and run clash:</p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl <span style=color:#a2f>enable</span> --now clash</span></span></code></pre></td></tr></table></div></div></div><p>Show Status</p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl status clash</span></span></code></pre></td></tr></table></div></div></div></div></div></div></div><div id=outline-container-headline-10 class=outline-3><h3 id=headline-10>(optional)Enable Web Control Panel</h3><div id=outline-text-headline-10 class=outline-text-3><ol><li>Add <code class=verbatim>secret: &lt;your password></code> to <code class=verbatim>/etc/clash/config.yaml</code></li><li>Allow port <code class=verbatim>9090</code> on your vps admin panel</li><li><p>restart clash service</p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>sudo systemctl restart clash</span></span></code></pre></td></tr></table></div></div></div></li></ol></div></div><div id=outline-container-headline-11 class=outline-3><h3 id=headline-11>Use Proxy</h3><div id=outline-text-headline-11 class=outline-text-3><div id=outline-container-headline-12 class=outline-4><h4 id=headline-12>Termainal Environment Variable</h4><div id=outline-text-headline-12 class=outline-text-4><p>use <code class=verbatim>export</code> to enable proxy one session
use <code>all_proxy=&lt;cmd></code> to use inline command proxy.
My fish script(<code class=verbatim>~/.config/fish/functions/gfw.fish</code>):</p><div class="src src-fish"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">9
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fish data-lang=fish><span style=display:flex><span><span style=color:#a2f;font-weight:700>function</span> <span style=color:#00a000>gfw</span>
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> <span style=color:#a2f;font-weight:700>test</span> <span style=color:#b44>&#34;</span><span style=color:#b8860b>$argv</span><span style=color:#b44>&#34;</span> <span style=color:#666>=</span> <span style=color:#b44>&#34;&#34;</span> <span style=color:#080;font-style:italic># if no argument is passed
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>        <span style=color:#a2f;font-weight:700>echo</span> <span style=color:#a2f;font-weight:700>set</span> <span style=color:#b8860b>global</span> proxy to <span style=color:#666>127</span>.<span style=color:#666>0</span>.<span style=color:#666>0</span>.<span style=color:#666>1</span>:<span style=color:#666>7890</span>
</span></span><span style=display:flex><span>        <span style=color:#00a000>export</span> <span style=color:#b8860b>all_proxy</span><span style=color:#666>=</span>http://<span style=color:#666>127</span>.<span style=color:#666>0</span>.<span style=color:#666>0</span>.<span style=color:#666>1</span>:<span style=color:#666>7890</span>
</span></span><span style=display:flex><span>        <span style=color:#a2f;font-weight:700>return</span> <span style=color:#666>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>end</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#00a000>env</span> <span style=color:#b8860b>all_proxy</span><span style=color:#666>=</span>http://<span style=color:#666>127</span>.<span style=color:#666>0</span>.<span style=color:#666>0</span>.<span style=color:#666>1</span>:<span style=color:#666>7890</span> <span style=color:#b8860b>$argv</span>
</span></span><span style=display:flex><span><span style=color:#a2f;font-weight:700>end</span></span></span></code></pre></td></tr></table></div></div></div></div></div><div id=outline-container-headline-13 class=outline-4><h4 id=headline-13>Git</h4><div id=outline-text-headline-13 class=outline-text-4><p>Recommend to use <code class=verbatim>ghproxy</code> instead of proxy.</p><div class="src src-shell"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>git config --global http.proxy http://127.0.0.1:7890
</span></span><span style=display:flex><span>git config --global https.proxy http://127.0.0.1:7890</span></span></code></pre></td></tr></table></div></div></div></div></div></div></div></div></div></article><aside><nav id=TableOfContents><ul><li><a href=#headline-1>Tips</a></li><li><a href=#headline-2>Steps</a><ul><li><a href=#headline-3>Download clash core</a></li><li><a href=#headline-4>Make clash configuration directory</a></li><li><a href=#headline-5>Config.yaml</a></li><li><a href=#headline-6>Country.mmdb</a></li><li><a href=#headline-7>Run clash daemon</a><ul><li><a href=#headline-8>One Method: manualy run</a></li><li><a href=#headline-9>Another Method: use service</a></li></ul></li><li><a href=#headline-10>(optional)Enable Web Control Panel</a></li><li><a href=#headline-11>Use Proxy</a><ul><li><a href=#headline-12>Termainal Environment Variable</a></li><li><a href=#headline-13>Git</a></li></ul></li></ul></li></ul></nav></aside></main></div><script src=/blog_meow/js/single.min.js></script></body></html>