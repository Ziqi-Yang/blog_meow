<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link rel=stylesheet href=https://ziqi-yang.github.io/blog_meow/scss/main.min.css></head><link rel=stylesheet href=https://ziqi-yang.github.io/blog_meow/scss/single.min.css><body><div id=nav-border><nav id=nav><a class=nav-link href=/blog_meow/>Home</a>
<a class=nav-link href=/blog_meow/tags/>Tags</a>
<a class=nav-link href=/blog_meow/archives/>Archives</a>
<a class=nav-link href=/blog_meow/about/>About me</a>
<a class=nav-link href=/blog_meow/index.xml>Rss</a></nav></div><div id=content><main><article><header><h1>Firefox Disable Ctrl-w</h1></header><p>As a vim key mapping user, I found firefox ctrl-w close tab is really a annoying key shortcut. Since in vim, the key shortcut ctrl-w is defaultly mapped as deleting a word.</p><div id=outline-container-headline-1 class=outline-2><h2 id=headline-1>Solution</h2><div id=outline-text-headline-1 class=outline-text-2><p>Create <code class=verbatim>/usr/lib/firefox/defaults/pref/autoconfig.js</code></p><div class="src src-js"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span>pref(<span style=color:#b44>&#34;general.config.filename&#34;</span>, <span style=color:#b44>&#34;firefox.cfg&#34;</span>); <span style=color:#080;font-style:italic>// our configuration file is called firefox.cfg at the roor directory of firefox lib
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>pref(<span style=color:#b44>&#34;general.config.obscure_value&#34;</span>, <span style=color:#666>0</span>);
</span></span><span style=display:flex><span>pref(<span style=color:#b44>&#34;general.config.sandbox_enabled&#34;</span>, <span style=color:#a2f;font-weight:700>false</span>); <span style=color:#080;font-style:italic>// after testing, it is needed to disable sanbox
</span></span></span></code></pre></td></tr></table></div></div></div><p>Create <code class=verbatim>/usr/lib/firefox/firefox.cfg</code></p><p>You can simply put your configuration here, but I recommend you to use it as an intermediate.</p><div class="src src-js"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#080;font-style:italic>// IMPORTANT: Start your code on the 2nd line. The first line is forced to be a comment
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>var</span> home <span style=color:#666>=</span> getenv(<span style=color:#b44>&#34;HOME&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;font-style:italic>// your configuration should be placed at ~/.mozilla/firefox/user.js
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span>lockPref(<span style=color:#b44>&#34;autoadmin.global_config_url&#34;</span>, <span style=color:#b44>&#34;file:&#34;</span> <span style=color:#666>+</span> home <span style=color:#666>+</span> <span style=color:#b44>&#34;/.mozilla/firefox/user.js&#34;</span>);</span></span></code></pre></td></tr></table></div></div></div><p>Create <code class=verbatim>~/.mozilla/firefox/user.js</code></p><div class="src src-js"><div class=highlight><div style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#080;font-style:italic>// disable ctrl+w
</span></span></span><span style=display:flex><span><span style=color:#080;font-style:italic></span><span style=color:#a2f;font-weight:700>try</span> {
</span></span><span style=display:flex><span> <span style=color:#a2f;font-weight:700>let</span> {classes<span style=color:#666>:</span>Cc, interfaces<span style=color:#666>:</span>Ci, manager<span style=color:#666>:</span>Cm, utils<span style=color:#666>:</span>Cu} <span style=color:#666>=</span> Components;
</span></span><span style=display:flex><span> <span style=color:#a2f;font-weight:700>const</span> {Services} <span style=color:#666>=</span> Cu.<span style=color:#a2f;font-weight:700>import</span>(<span style=color:#b44>&#39;resource://gre/modules/Services.jsm&#39;</span>);
</span></span><span style=display:flex><span> <span style=color:#a2f;font-weight:700>function</span> ConfigJS() { Services.obs.addObserver(<span style=color:#a2f;font-weight:700>this</span>, <span style=color:#b44>&#39;chrome-document-global-created&#39;</span>, <span style=color:#a2f;font-weight:700>false</span>); }
</span></span><span style=display:flex><span> ConfigJS.prototype <span style=color:#666>=</span> {
</span></span><span style=display:flex><span>  observe<span style=color:#666>:</span> <span style=color:#a2f;font-weight:700>function</span> (aSubject) { aSubject.addEventListener(<span style=color:#b44>&#39;DOMContentLoaded&#39;</span>, <span style=color:#a2f;font-weight:700>this</span>, {once<span style=color:#666>:</span> <span style=color:#a2f;font-weight:700>true</span>}); },
</span></span><span style=display:flex><span>  handleEvent<span style=color:#666>:</span> <span style=color:#a2f;font-weight:700>function</span> (aEvent) {
</span></span><span style=display:flex><span>   <span style=color:#a2f;font-weight:700>let</span> <span style=color:#a2f>document</span> <span style=color:#666>=</span> aEvent.originalTarget;
</span></span><span style=display:flex><span>   <span style=color:#a2f;font-weight:700>let</span> <span style=color:#a2f>window</span> <span style=color:#666>=</span> <span style=color:#a2f>document</span>.defaultView;
</span></span><span style=display:flex><span>   <span style=color:#a2f;font-weight:700>let</span> location <span style=color:#666>=</span> <span style=color:#a2f>window</span>.location;
</span></span><span style=display:flex><span>   <span style=color:#a2f;font-weight:700>if</span> (<span style=color:#b68>/^(chrome:(?!\/\/(global\/content\/commonDialog|browser\/content\/webext-panels)\.x?html)|about:(?!blank))/i</span>.test(location.href)) {
</span></span><span style=display:flex><span>    <span style=color:#a2f;font-weight:700>if</span> (<span style=color:#a2f>window</span>._gBrowser) {
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>let</span> attr, elm, key, mbo;
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>let</span> KEYS <span style=color:#666>=</span> [<span style=color:#b44>&#39;key_close&#39;</span>];
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>let</span> ATTR <span style=color:#666>=</span> [<span style=color:#b44>&#39;key&#39;</span>,<span style=color:#b44>&#39;modifiers&#39;</span>,<span style=color:#b44>&#39;command&#39;</span>,<span style=color:#b44>&#39;oncommand&#39;</span>];
</span></span><span style=display:flex><span>      <span style=color:#a2f;font-weight:700>for</span> (key <span style=color:#a2f;font-weight:700>in</span> KEYS){
</span></span><span style=display:flex><span>       elm <span style=color:#666>=</span> <span style=color:#a2f>window</span>.<span style=color:#a2f>document</span>.getElementById(KEYS[key]);
</span></span><span style=display:flex><span>       <span style=color:#a2f;font-weight:700>if</span> (elm) <span style=color:#a2f;font-weight:700>for</span> (attr <span style=color:#a2f;font-weight:700>in</span> ATTR) <span style=color:#a2f;font-weight:700>if</span> (ATTR[attr] <span style=color:#a2f;font-weight:700>in</span> elm.attributes) elm.removeAttribute(ATTR[attr]);
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>   }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span> };
</span></span><span style=display:flex><span> <span style=color:#a2f;font-weight:700>if</span> (<span style=color:#666>!</span>Services.appinfo.inSafeMode) { <span style=color:#a2f;font-weight:700>new</span> ConfigJS(); }
</span></span><span style=display:flex><span>} <span style=color:#a2f;font-weight:700>catch</span>(e) {Cu.reportError(e);}</span></span></code></pre></td></tr></table></div></div></div></div></div><div id=outline-container-headline-2 class=outline-2><h2 id=headline-2>Tips and Tricks</h2><div id=outline-text-headline-2 class=outline-text-2><ul><li>To debug all the keybindings, please goto <code class=verbatim>chrome://browser/content/browser.xhtml</code>, and open your development tool(<code class=verbatim>f12</code>)</li><li>Disable and eneble firefox options: <code class=verbatim>about:config</code></li><li>Aur package <code class=verbatim>firefox-user-autoconfig</code> does the first two steps, however, it doesn't disable firefox sandbox currently(v1-1), so you need to disable it by yourself.</li></ul></div></div><div id=outline-container-headline-3 class=outline-2><h2 id=headline-3>Useful Resources</h2><div id=outline-text-headline-3 class=outline-text-2><ul><li><a href=https://support.mozilla.org/en-US/kb/customizing-firefox-using-autoconfig>https://support.mozilla.org/en-US/kb/customizing-firefox-using-autoconfig</a></li><li><a href=https://support.mozilla.org/en-US/questions/1378404>https://support.mozilla.org/en-US/questions/1378404</a></li></ul></div></div></article><aside><nav id=TableOfContents><ul><li><a href=#headline-1>Solution</a></li><li><a href=#headline-2>Tips and Tricks</a></li><li><a href=#headline-3>Useful Resources</a></li></ul></nav></aside></main></div><script src=/blog_meow/js/single.min.js></script></body></html>